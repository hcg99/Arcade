<!DOCTYPE HTML>
<html>
<head>
	<title>Arcade Game</title>
</head>
<body>
<canvas id='canvas' width='600' height='600'></canvas>

<script>
var canvas = document.getElementById('canvas');
var ctx =  canvas.getContext('2d');

var snakex = 300;
var snakey = 400;
var speedx = speedy = 0;
var spd = 16;
var blocky = 0;
var blockspeed = 10;
var gs = 25;
var bs = 100;
var tl = 5;
var h = []
var fault = false;
var score = 0;
var printScore = false;
var countDown = 99;
var countDownTime = 700;
var rnd;
var turbo_mode = false;
var turbo_intro = false;
var turbo_counter = 0;
var turbo_intro_length_seconds = 2
var turbo_blockspeed = 15;
var turbo_score = 30

window.onload = function() {
	rnd = Math.floor(Math.random()* 4 +1);
	//rnd2 = Math.floor(Math.random()* 6);
	initialFill();
	const myInterval = setInterval(initialFill, countDownTime);
	setTimeout(() => { setInterval(game, 20); clearInterval(myInterval); }, countDownTime*4);
	// key down for when a key is pressed (move the snake)
	window.addEventListener('keydown', keyd);
	//window.addEventListener('keydown', keyd2);
	// key up for when the key is released (snake stops moving)
	window.addEventListener('keyup', keyu);
	//window.addEventListener('keyup', keyu2);

  window.addEventListener('mousemove', function(x) {
    var mousePos = mouse(x);
    if (turbo_mode == true) {
      snakex = mousePos.x - (gs-2)/2;
    }
  });
}

function initialFill () {
	//canvas
	ctx.fillStyle = 'black';
	ctx.fillRect(0,0,canvas.width,canvas.height);

	//snake
	ctx.fillStyle = 'lime';
	for (var i = 0; i < tl; i++) {
		ctx.fillRect(snakex, snakey + gs*i, gs-2, gs-2);
	}

	//count down
	ctx.fillStyle = 'lime';
	ctx.font = '50px Ariel';
	ctx.textAlign = 'center';
	if (countDown == 99) {
		ctx.fillText('Ready?', 300, 250);
		countDown = 3;
	} else if (countDown != 0) {
		ctx.fillText(countDown, 300, 250);
		countDown -= 1;
	}
}

function game() {
	//canvas
	ctx.fillStyle = 'black';
	ctx.fillRect(0,0,canvas.width,canvas.height);

	//blocks
	if (blocky > 600) {
		blocky = 0;
		h = [];
		fault = false;
		score++;
    if (score > turbo_score && turbo_counter == 0) {
      turbo();
    }
		rnd = Math.floor(Math.random()* 6);
		//rnd2 = Math.floor(Math.random()* 6);
	}
	h[rnd] = 1;
	//h[rnd2] = 2;
	for (var j = 0; j < 6; j++) {
		ctx.fillStyle = 'orange';

		if (h[j] != 1) {

			ctx.fillRect(0 + bs*j, blocky, bs-2, bs-2);
		} /*else {
			ctx.fillStyle = '#ff7738';
			ctx.fillRect(0 + bs*j, blocky, bs, bs);
			}
		if (h[j] == 2) {
			ctx.fillStyle = '#ff7738';
			ctx.fillRect(0 + bs*j, blocky, bs, bs);
		}*/
	}

	//snake
	ctx.fillStyle = 'lime';
	for (var i = 0; i < tl; i++) {
		ctx.fillRect(snakex, snakey + gs*i, gs-2, gs-2);
	}

  //turbo
  if (turbo_intro == true) {
    ctx.fillStyle = 'lime';
  	ctx.font = '50px Ariel';
  	ctx.textAlign = 'center';
  	ctx.fillText('Turbo Mode Activated', 300, 250);
  	ctx.fillText('Use Your Mouse', 300, 330);
    turbo_counter += 1;
    if (turbo_counter > turbo_intro_length_seconds*50) {
      turbo_intro = false;
      blockspeed = turbo_blockspeed;
    }
  }

	//move & boarder
	snakex += speedx;
	blocky += blockspeed;

	if (snakex < 0) {
		speedx = 0;
		snakex = 0;
	} else if (snakex > canvas.width - 25) {
		speedx = 0;
		snakex = canvas.width - 25;
	}

	//collide
	if (snakey >= blocky-gs*tl && snakey <= blocky + bs && fault == false && h[Math.floor((snakex + 12)/100)] != 1) {
			console.log(h[Math.floor((snakex + 12)/100)]);
		if (h[Math.floor((snakex + 12)/100)] == 2) {
			tl += 3;
		}
		if (snakex <= bs - 12) {
			h[0] = 1;
		} else if (snakex <= bs*2 - 12) {
			h[1] = 1;
		} else if (snakex <= bs*3 - 12) {
			h[2] = 1;
		} else if (snakex <= bs*4 - 12) {
			h[3] = 1;
		} else if (snakex <= bs*5 - 12) {
			h[4] = 1;
		} else if (snakex <= bs*6 - 12) {
			h[5] = 1;
		}
		tl--;
		if (tl == 0) {
			blockspeed = 0;
			score -= 4
			console.log('score: ' + score);
			printScore = true
		}
		blocky -= blockspeed;
		fault = true;
	}

	if (printScore) {
		ctx.fillStyle = 'lime'
		ctx.font = '50px Ariel'
		ctx.textAlign = 'center'
		ctx.fillText('Score: ' + score, 300, 200)
	}

}

  //turbo
function turbo() {
    turbo_mode = true;
    turbo_intro = true;
    blockspeed = 0;
}

  //mouse
function mouse(evt) {
	var rect = canvas.getBoundingClientRect();
	var root = document.documentElement;
	var mouseX = evt.clientX - rect.left - root.scrollLeft;
	var mouseY = evt.clientY - rect.top - root.scrollTop;
	return { x:mouseX, y:mouseY };
}

	//keys
function keyd() {
	switch (event.keyCode) {
		case 65:
			speedx = -spd;
			break;
		case 37:
			speedx = -spd;
			break;
		case 68:
			speedx = spd;
			break;
		case 39:
			speedx = spd;
			break;
	}
}

function keyu() {
	switch (event.keyCode) {
		case 65:
			speedx = 0;
			break;
		case 68:
			speedx = 0;
			break;
		case 37:
			speedx = 0;
			break;
		case 39:
			speedx = 0;
			break;
	}
}

function keyd2() {
	switch (event.keyCode) {
		case 37:
			speedx = -spd;
			break;
		case 39:
			speedx = spd;
			break;
	}
}

function keyu2() {
	switch (event.keyCode) {
		case 37:
			speedx = 0;
			break;
		case 39:
			speedx = 0;
			break;
	}

}

</script>

 </body>
 </html>
